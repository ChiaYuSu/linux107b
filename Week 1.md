# 第一週筆記
## 本學期內容
* 上學期課本剩餘部分：DNS、Docker
* 除了課本內容之外還會補充 Docker - compose、SWAM

## 期中考、期末考評量方式
* 由於老師不知道本科該如何考試比較好，預計期中考的成績由筆記來取代；至於期末考的部分將由報告（內容為上課有講到但沒有實作的內容或是自己寫腳本）取代

## 負載均衡 - Load Balance
* 負載均衡，英文全名為 Load Balance(LB)，簡單來說就是討論如何讓伺服器執行得更流暢
* 相關主題如下：
    * LVS
    * HAProxy
    * Nginx
* 負載均衡入口前端會有虛擬位址（Virtual IP, VIP），能避免直接將主機位址暴露到 Internet 上

## 正向代理伺服器以及反向代理伺服器
### 正向代理（forward proxy）伺服器
* 定義：所謂正向代理伺服器就是用戶（假設為 A）**透過代理伺服器**（假設為 Z）代理用戶（A）去訪問目標伺服器（假設為 B）
* 用途：
    * **突破訪問限制**：通過代理伺服器，可以突破自身 IP 訪問限制，訪問國外網站
    * **提高訪問速度**：通常代理伺服器都設置一個較大的硬碟緩衝區，會將部分請求的響應保存到緩衝區中，當其他用戶在訪問相同的訊息時，則直接由轟衝區中取出訊息。
    * **隱藏客戶端真實 IP**：用戶可以透過代理伺服器隱藏自己的 IP 位址
* 相關套件：Squid<br>

    <img src="Week1\forward_proxy.jpg" width="550px" /> 

### 反向代理（reverse proxy）伺服器
* 定義：正好與正向代理相反，反向代理伺服器（假設為 Z）對於用戶（假設為 A）而言就像是原始伺服器（假設為 B），並且用戶端（A）不需要做任何特殊設置。客戶端（A）像反向代理伺服器（Z）發出請求，接著反向代理伺服器（Z）將判斷何處轉交請求，並將獲得的內容返回給客戶端（A）
* 用途：
    * **隱藏伺服器真實 IP**：代理伺服器可以對用戶端隱藏伺服器的 IP 位址
    * **負載均衡**：反向代理伺服器可以做負載均衡，根據所有真實伺服器的負載狀況，將客戶端請求分發到不同的真實伺服器上
    * **提高訪問速度**：反向代理伺服器可以於靜態內容極短時間內有大量訪問請求的動態內容提供緩存服務，提高訪問速度
    * **提供安全保障**：反向代理伺服器可以做為應用層防火牆，為網站提供對基於 Web 的攻擊行為（如：DDoS攻擊）的防護，更容易排茶惡意軟體。此外，還可以為後端伺服器統一提供加密和 SSL 加速，提供 HTTP 訪問認證
* 相關套件：Nginx、Apache、LVS、HAProxy
    > 註：Nginx 並非專門的 Load Balancer，因為採用 Round Robin 機制，會輪流詢問各個主機（沒有優先權概念），導致效能較好的主機不能長時間佔用。因此一般還是建議採用 LVS、HAProxy
    <br>

    <img src="Week1\reverse_proxy.jpg" width="550px" /> 

### 正向代理伺服器與反向代理伺服器的差異
1. **正向代理其實是客戶端的代理**，幫助客戶端訪問其無法訪問的伺服器資源。**反向代理則是伺服器的代理**，幫助伺服器做負載均衡、安全防護等
2. **正向代理一般是客戶端架設的**，比如在自己的機器上安裝一個代理軟體。而**反向代理一般是伺服器架設的**，比如在自己的機器集群中部署一個反向代理伺服器
3. **正向代理中，伺服器不知道真正的客戶端到底是誰**，以為訪問自己的就是真實的客戶端。而在**反向代理中，客戶端不知道真正的伺服器是誰**，以為自己訪問的就是真實的伺服器
4. 正向代理和反向代理的作用和目的不同。**正向代理主要是用來解決訪問限制問題**。而**反向代理則是提供負載均衡、安全防護等作用**。兩者均能提高訪問速度

## Apache 與 Nginx 的差異
* Apache 及 Nginx 皆為反向代理伺服器
* 一台 Apache 最高同時只有約一萬台連線數，可是一台 Nginx 卻能支援到約三萬台連線數（採用輪詢機制，為事件驅動的方式）
* 儘管 Nginx 效能較好，但針對現今的環境可能還是不夠用

## 監控軟體
### Zabbix
* 功能性較強大
* 如果服務壞掉，傳統上只能透過 E-mail 通知，但透過其中的二次開發功能，目前有辦法寫出透過第三方通訊軟體（如：微信）發送通知的功能

### Nagios
* 較簡單，往後的課程會花幾個禮拜的時間來介紹
* 有分直接監控與間接監控
    * 直接監控：監視器與被控端直接連接（能透過 `ping`、`curl` 等指令確認）
    * 間接監控：有些系統資源沒辦法直接量測，因此派一個 agent 在被控端偵測，再回傳給主控端

## 自動化管理
* 當管理大量的裝置時，不可能一台機器一台機器做設置，因此需要有大量管理工具，方便部署與更新
* 常見的套件如下：
    * saltstack
    * ansible
    * puppet

## 腳本
* 應用如偵測 ARP 攻擊
* 易於管理與維護

## 網路電話（VoIP）
* 可以參考延伸學習的第 2 點

## 直播系統
* 可以參考延伸學習的第 3 點
* RTMP：直播串流用的通訊協定
* iPhone 使用者可以在 App Store 下載 mPlayer 做測試

## 延伸學習
1. [鳥哥的 Linux 私房菜 / 第十七章、區網控制者： Proxy 伺服器](http://linux.vbird.org/linux_server/0420squid.php)
2. [SIP:WISE / Build your own VoIP System – Part 2: An open Skype Replacement](https://www.sipwise.org/news/technical/byov-skype-replacement/)
3. [简书 / 在Centos7上搭建Nginx+rtmp服务器](https://www.jianshu.com/p/4ed63b041bd9)